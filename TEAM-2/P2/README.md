# 用户登录验证系统

## 项目简介

这是一个完整的Web后端验证系统，实现了用户登录验证功能。系统采用模块化设计，包含Web通信、加密算法、身份验证等多个模块。

## 系统架构

```
┌─────────────────────────────────────────────────────────┐
│                     main.c (主模块)                      │
│                   - 流程控制和集成                        │
└─────────────────────────────────────────────────────────┘
                            │
        ┌───────────────────┼───────────────────┐
        │                   │                   │
┌───────▼────────┐  ┌──────▼───────┐  ┌───────▼────────┐
│   web.py       │  │  login.c     │  │ algorithm.py   │
│  Web通信模块    │  │  登录验证     │  │  加密算法      │
└────────────────┘  └──────────────┘  └────────────────┘
        │                   │                   │
        └───────────────────┼───────────────────┘
                            │
                    ┌───────▼────────┐
                    │   share.txt    │
                    │   数据交换      │
                    └────────────────┘
                            │
                    ┌───────▼────────┐
                    │  DATA.xlsx     │
                    │  用户数据库     │
                    └────────────────┘
```

## 文件说明

### 核心模块

- **main.c** - 主集成模块
  - 启动Web服务器
  - 等待用户输入
  - 调用登录验证
  - 清理共享文件
  - 返回验证结果

- **web.py** - Web通信模块
  - 接收前端登录数据
  - 数据格式验证
  - 将数据写入share.txt

- **login.c** - 登录验证模块
  - 读取共享数据
  - 调用MD5算法验证密码
  - 读取数据库比对
  - 更新登录记录

- **algorithm.py** - 算法模块
  - MD5哈希算法
  - SHA1哈希算法
  - RSA加密/解密
  - PKCS#7填充

### 数据文件

- **DATA.xlsx** - 用户数据库
  - 存储用户信息
  - 记录登录历史
  
- **share.txt** - 数据交换文件
  - Web模块与登录模块间的数据传递

### 辅助脚本

- **build_and_run.py** - 系统构建脚本
  - 检查依赖
  - 编译C模块
  - 启动系统

- **init_data.py** - 数据初始化脚本
  - 创建用户数据库
  - 生成测试账户

- **test_login.py** - 登录模块测试脚本

## 快速开始

### 1. 系统要求

- Python 3.7+
- GCC 编译器
- 浏览器（用于登录界面）

### 2. 安装依赖

```bash
pip install flask pandas openpyxl pycryptodome
```

### 3. 一键构建和运行

```bash
python build_and_run.py
```

### 4. 手动构建

```bash
# 1. 初始化数据库
python init_data.py

# 2. 编译C模块
gcc -o login login.c
gcc -o main main.c

# 3. 运行主程序
./main          # Linux/Mac
main.exe        # Windows
```

## 使用说明

### 登录流程

1. 启动主程序后选择"开始登录流程"
2. 系统自动启动Web服务器
3. 浏览器打开 http://127.0.0.1:5000
4. 输入用户名和密码
5. 系统自动验证并返回结果

### 测试账户

| 用户名   | 密码        |
|---------|------------|
| admin   | admin123   |
| testuser| password1  |
| user123 | mypass456  |

### 验证规则

- **用户名**: 不超过8位
- **密码**: 大于6位且不超过12位
- **Cookie**: 必须包含flag标签

## 功能特性

### ✅ 已实现功能

1. **Web通信**
   - Flask Web服务器
   - 可视化登录界面
   - Cookie验证

2. **数据验证**
   - 用户名长度检查
   - 密码长度检查
   - Cookie标签验证

3. **加密算法**
   - MD5哈希
   - SHA1哈希
   - RSA加密/解密
   - PKCS#7填充

4. **身份验证**
   - 密码MD5校验
   - 数据库比对
   - 登录记录更新

5. **模块集成**
   - 自动化流程控制
   - 数据交换管理
   - 错误处理

## 命名规范

遵循 NAME.md 中的命名规则：

- **变量**: 蛇形命名法 (snake_case)
  - 前端数据: `pre_` 前缀
  - 返回数据: `ret_` 前缀

- **函数**: 大驼峰命名法 (PascalCase)
  - 示例: `CalculateMD5()`, `PerformLogin()`

- **结构体**: `t_` 前缀 + 蛇形命名
  - 示例: `t_user_data`, `t_login_info`

- **常量**: 全大写
  - 示例: `MAX_LENGTH`, `SUCCESS`

## 测试

### 运行完整测试

```bash
# 测试算法模块
python algorithm.py console

# 测试Web模块
python web.py test

# 测试登录模块
python test_login.py
```

### 测试场景

1. ✓ 正确的用户名和密码
2. ✓ 用户名过长
3. ✓ 密码过短
4. ✓ 密码过长
5. ✓ Cookie缺失
6. ✓ 用户不存在

## 常见问题

### Q: 编译失败怎么办？
A: 确保已安装GCC编译器。Windows用户可以安装MinGW。

### Q: Web服务器无法启动？
A: 检查5000端口是否被占用，或者修改web.py中的端口配置。

### Q: 找不到Python包？
A: 运行 `python build_and_run.py` 会自动检查并安装依赖。

### Q: 登录一直失败？
A: 检查密码是否符合长度要求（>6位且≤12位），用户名是否存在于DATA.xlsx中。

## 项目结构

```
P2/
├── main.c              # 主集成模块
├── login.c             # 登录验证模块
├── web.py              # Web通信模块
├── algorithm.py        # 算法模块
├── DATA.xlsx           # 用户数据库
├── share.txt           # 数据交换文件
├── key.txt             # RSA私钥
├── init_data.py        # 数据初始化脚本
├── test_login.py       # 登录测试脚本
├── build_and_run.py    # 构建运行脚本
├── PLAN.md             # 项目计划
├── NAME.md             # 命名规范
└── README.md           # 本文件
```

## 开发团队

TEAM-2 P2项目组

## 许可证

本项目仅用于教学和实践目的。
